generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
}

model User {
  id           String        @id @default(cuid())
  email        String        @unique
  password     String?       // nullable â€” Google-only users have no password
  googleId     String?       @unique   // Google OAuth subject ID
  avatarUrl    String?                 // Google profile picture
  enrollmentNo String?       @unique
  name         String
  role         UserRole      @default(STUDENT)
  department   String?
  createdAt    DateTime      @default(now())
  applications Application[] @relation("StudentApplications")
}

model Application {
  id                 String            @id @default(cuid())
  applicationNo      String            @unique
  studentId          String
  status             ApplicationStatus @default(IN_PROGRESS)
  fullName           String
  fatherName         String
  phoneNumber        String
  address            String
  passOutYear        Int
  course             String
  cgpa               Float
  isHostelResident   Boolean           @default(false)
  hostelName         String?
  roomNumber         String?
  cautionMoneyRefund Boolean           @default(false)
  receiptNumber      String?
  feeReceipts        String[]
  marksheet          String?
  bankDetails        String?
  collegeId          String?
  currentStage       Int               @default(1)
  createdAt          DateTime          @default(now())
  updatedAt          DateTime          @updatedAt
  student            User              @relation("StudentApplications", fields: [studentId], references: [id])
  approvals          Approval[]

  @@index([studentId])
}

model Approval {
  id            String         @id @default(cuid())
  applicationId String
  stage         Int
  department    String
  status        ApprovalStatus @default(UNDER_REVIEW)
  remarks       String?
  actionDate    DateTime?
  approvedBy    String?
  application   Application    @relation(fields: [applicationId], references: [id])

  @@index([applicationId])
  @@index([department, stage, status])
}

enum UserRole {
  STUDENT
  FACULTY
  CLASS_COORDINATOR
  HOD
  HOSTEL_WARDEN
  LIBRARY_ADMIN
  WORKSHOP_ADMIN
  TP_OFFICER
  GENERAL_OFFICE
  ACCOUNTS_OFFICER
  SUPER_ADMIN
}

enum ApplicationStatus {
  IN_PROGRESS
  SUBMITTED
  FULLY_APPROVED
  REJECTED
}

enum ApprovalStatus {
  UNDER_REVIEW
  APPROVED
  REJECTED
}
